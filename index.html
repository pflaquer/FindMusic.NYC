import React, { useState } from 'react';

// Use a fixed primary color for musical theme accents
const PRIMARY_COLOR = 'indigo-400';
const SECONDARY_COLOR = 'purple-600';

// --- Icon Components (Inline SVG) ---

const UserIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
);
const MapPinIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="3"/></svg>
);
const MessageCircleIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
);
const SettingsIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 5 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 2-2v-2a2 2 0 0 1-2-2h-.09A1.65 1.65 0 0 0 3.4 5l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V15z"/></svg>
);
const ListPlusIcon = (props) => (
  <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 12H3"/><path d="M16 12H3"/><path d="M21 12h-2"/><path d="M7 12V3"/><path d="M12 12V3"/><path d="M17 12V3"/><path d="M11 21H3"/><path d="M16 21H3"/><path d="M21 21h-2"/></svg>
);


// --- View Components ---

const Header = ({ title }) => (
    <header className="fixed top-0 left-0 right-0 z-10 p-4 bg-gray-900 border-b border-gray-800 shadow-xl">
        <h1 className="text-xl font-bold text-white text-center">{title}</h1>
    </header>
);

const ProfileView = () => (
    <div className="p-4 pt-16 space-y-6 text-center">
        <div className="mx-auto w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center border-4 border-indigo-400">
            <UserIcon className="w-16 h-16 text-indigo-400" strokeWidth={1} />
        </div>
        <h2 className="text-3xl font-extrabold text-white">Alex 'The Rhythm' Chen</h2>
        <p className="text-gray-400">Acoustic Guitar & Vocals | Jazz, Folk</p>

        <div className="bg-gray-800 p-4 rounded-xl shadow-lg">
            <h3 className="text-xl font-semibold text-white mb-3">About Me</h3>
            <p className="text-gray-400 text-sm leading-relaxed">
                Finding the sweet spots in the city to share some soulful tunes. I usually play near the Central Park fountain or the Subway entrance after 5 PM.
            </p>
        </div>

        <button className={`w-full py-3 rounded-xl font-semibold bg-${PRIMARY_COLOR} text-gray-900 transition hover:bg-indigo-300`}>
            Edit Profile
        </button>
    </div>
);

const MapView = () => {
    // Mock busker data for map pins
    const buskers = [
        { name: "Mia", genre: "Violin", time: "Now", color: 'red' },
        { name: "Jake", genre: "Drums", time: "30m ago", color: 'yellow' },
        { name: "Duo", genre: "Acoustic", time: "1h ago", color: 'green' },
    ];

    return (
        <div className="relative h-full">
            {/* Simulated Map Area */}
            <div className="flex flex-col items-center justify-center h-full bg-gray-800 text-white p-4">
                <div className="text-2xl font-bold mb-4">üìç Central City Plaza</div>
                <p className="text-gray-400 mb-6">Live Map (Simulated)</p>
                
                {/* Simulated Busker Pins */}
                <div className="absolute top-1/4 left-1/4 p-2 bg-red-600 rounded-full shadow-lg border-2 border-white animate-pulse cursor-pointer">
                    <MapPinIcon className="w-5 h-5 text-white" />
                </div>
                <div className="absolute top-3/5 right-1/3 p-2 bg-yellow-600 rounded-full shadow-lg border-2 border-white animate-pulse cursor-pointer">
                    <MapPinIcon className="w-5 h-5 text-white" />
                </div>
                <div className="absolute bottom-1/4 left-3/4 p-2 bg-green-600 rounded-full shadow-lg border-2 border-white opacity-70 cursor-pointer">
                    <MapPinIcon className="w-5 h-5 text-white" />
                </div>
            </div>

            {/* Live Busker List Overlay */}
            <div className="absolute bottom-0 w-full p-4 bg-gray-900/90 backdrop-blur-sm rounded-t-2xl border-t border-gray-700">
                <h3 className="text-lg font-semibold text-white mb-3">Live Buskers Nearby (3)</h3>
                <div className="space-y-2">
                    {buskers.map((busker) => (
                        <div key={busker.name} className="flex justify-between items-center p-3 bg-gray-800 rounded-xl shadow-md">
                            <div className="flex items-center space-x-3">
                                <div className={`w-3 h-3 rounded-full bg-${busker.color}-400`}></div>
                                <span className="font-medium text-white">{busker.name}</span>
                                <span className="text-xs font-light text-gray-500">‚Ä¢ {busker.genre}</span>
                            </div>
                            <button className={`text-xs font-semibold text-gray-900 px-3 py-1 rounded-full bg-${PRIMARY_COLOR}`}>
                                View
                            </button>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
}

const MessagesView = () => {
    // Mock conversations
    const chats = [
        { id: 1, name: "Street Jam Organizer", lastMessage: "See you at the spot on Friday!", time: "10:30 AM", unread: 2 },
        { id: 2, name: "Fan of the Day", lastMessage: "Your set yesterday was amazing!", time: "Yesterday", unread: 0 },
        { id: 3, name: "Guitar Repair Shop", lastMessage: "Your custom strings are ready.", time: "Mon", unread: 0 },
    ];

    return (
        <div className="p-4 pt-16 space-y-3">
            <h2 className="text-2xl font-bold text-white mb-4">Direct Messages</h2>
            {chats.map((chat) => (
                <div key={chat.id} className="flex items-center space-x-4 p-3 bg-gray-800 rounded-xl transition hover:bg-gray-700 cursor-pointer">
                    <div className="relative w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center">
                        <MessageCircleIcon className="w-6 h-6 text-gray-400" />
                        {chat.unread > 0 && (
                            <span className={`absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center text-xs font-bold text-white bg-${SECONDARY_COLOR} rounded-full`}>
                                {chat.unread}
                            </span>
                        )}
                    </div>
                    <div className="flex-1 min-w-0">
                        <p className="font-semibold text-white truncate">{chat.name}</p>
                        <p className="text-sm text-gray-400 truncate">{chat.lastMessage}</p>
                    </div>
                    <span className="text-xs text-gray-500 flex-shrink-0">{chat.time}</span>
                </div>
            ))}
            <div className="text-center pt-4">
                <button className={`text-${PRIMARY_COLOR} font-medium`}>Start New Chat</button>
            </div>
        </div>
    );
};

const SettingsView = () => (
    <div className="p-4 pt-16 space-y-6">
        <h2 className="text-2xl font-bold text-white mb-4">App Settings</h2>

        <div className="bg-gray-800 p-4 rounded-xl space-y-3 shadow-lg">
            <div className="flex justify-between items-center pb-2 border-b border-gray-700">
                <span className="text-white">Push Notifications</span>
                <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="toggle-push" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-gray-600 border-4 appearance-none cursor-pointer checked:bg-indigo-500 checked:right-0" defaultChecked/>
                    <label htmlFor="toggle-push" className="toggle-label block overflow-hidden h-6 rounded-full bg-gray-700 cursor-pointer"></label>
                </div>
            </div>

            <div className="flex justify-between items-center pb-2 border-b border-gray-700">
                <span className="text-white">Location Sharing (Live)</span>
                <div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="toggle-location" className="toggle-checkbox absolute block w-6 h-6 rounded-full bg-gray-600 border-4 appearance-none cursor-pointer checked:bg-indigo-500 checked:right-0" />
                    <label htmlFor="toggle-location" className="toggle-label block overflow-hidden h-6 rounded-full bg-gray-700 cursor-pointer"></label>
                </div>
            </div>

            <p className="text-sm text-gray-500 pt-2">
                *The dark theme is mandatory and cannot be changed.
            </p>
        </div>

        <button className="w-full py-3 rounded-xl font-semibold bg-red-600 text-white transition hover:bg-red-700">
            Log Out
        </button>
    </div>
);

const RequestsView = () => {
    // Mock requests data
    const requests = [
        { id: 1, type: "Song Request", user: "Sarah K.", song: "Wonderwall - Oasis", status: "Pending", color: 'yellow' },
        { id: 2, type: "Gig Invite", user: "Local Cafe Owner", song: "Friday Night Slot", status: "Accepted", color: 'green' },
        { id: 3, type: "Collaboration", user: "Drummer Mike", song: "Improvisational Session", status: "Rejected", color: 'red' },
    ];

    const getStatusClasses = (status) => {
        switch (status) {
            case 'Accepted': return `bg-green-600 text-green-100`;
            case 'Pending': return `bg-yellow-600 text-yellow-100`;
            case 'Rejected': return `bg-red-600 text-red-100`;
            default: return `bg-gray-500 text-white`;
        }
    }

    return (
        <div className="p-4 pt-16 space-y-4">
            <h2 className="text-2xl font-bold text-white mb-4">My Requests & Invites</h2>

            <div className="space-y-3">
                {requests.map((req) => (
                    <div key={req.id} className="p-4 bg-gray-800 rounded-xl shadow-lg">
                        <div className="flex justify-between items-start mb-2">
                            <span className={`text-sm font-semibold rounded-full px-3 py-1 ${getStatusClasses(req.status)}`}>
                                {req.type}
                            </span>
                            <span className="text-xs text-gray-500">{req.user}</span>
                        </div>
                        <h3 className="text-lg font-medium text-white">{req.song}</h3>
                        <p className="text-sm text-gray-400">
                            {req.type === 'Song Request' ? 'Requested song from the crowd.' : 'Invitation for a paid performance.'}
                        </p>

                        <div className="mt-3 flex space-x-2">
                            {req.status === 'Pending' && (
                                <>
                                    <button className={`flex-1 py-2 rounded-lg text-sm font-semibold bg-${PRIMARY_COLOR} text-gray-900`}>Accept</button>
                                    <button className="flex-1 py-2 rounded-lg text-sm font-semibold border border-red-500 text-red-400 hover:bg-red-500 hover:text-white transition">Decline</button>
                                </>
                            )}
                            {req.status !== 'Pending' && (
                                <span className="text-sm font-medium text-gray-500">Action Complete</span>
                            )}
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
};


// --- Bottom Navigation Component ---

const BottomNav = ({ currentRoute, setCurrentRoute }) => {
    const navItems = [
        { name: 'Profile', icon: UserIcon },
        { name: 'Map', icon: MapPinIcon },
        { name: 'Messages', icon: MessageCircleIcon },
        { name: 'Requests', icon: ListPlusIcon },
        { name: 'Settings', icon: SettingsIcon },
    ];

    return (
        <footer className="fixed bottom-0 left-0 right-0 z-20 bg-gray-900 border-t border-gray-800 shadow-2xl">
            <nav className="flex justify-around items-center h-16 max-w-sm mx-auto">
                {navItems.map((item) => {
                    const isActive = currentRoute === item.name;
                    const Icon = item.icon;
                    const activeColor = isActive ? PRIMARY_COLOR : 'gray-500';

                    return (
                        <button
                            key={item.name}
                            onClick={() => setCurrentRoute(item.name)}
                            className="flex flex-col items-center justify-center p-2 transition duration-150 ease-in-out"
                            aria-label={`Maps to ${item.name}`}
                        >
                            <Icon className={`w-6 h-6 text-${activeColor}`} />
                            <span className={`text-xs font-medium mt-0.5 text-${activeColor}`}>
                                {item.name}
                            </span>
                        </button>
                    );
                })}
            </nav>
        </footer>
    );
};

// --- Main App Component ---

const App = () => {
    const [currentRoute, setCurrentRoute] = useState('Map');

    const renderView = () => {
        switch (currentRoute) {
            case 'Profile':
                return <ProfileView />;
            case 'Map':
                return <MapView />;
            case 'Messages':
                return <MessagesView />;
            case 'Settings':
                return <SettingsView />;
            case 'Requests':
                return <RequestsView />;
            default:
                return <MapView />;
        }
    };

    return (
        <div className="min-h-screen bg-gray-900 text-white font-sans flex flex-col items-center">
            {/* Tailwind CSS utility for styling the checkbox/toggle switch */}
            <style jsx="true">{`
                .toggle-checkbox:checked {
                    right: 0;
                    border-color: #6366f1; /* indigo-500 */
                }
                .toggle-checkbox:checked + .toggle-label {
                    background-color: #6366f1; /* indigo-500 */
                }
                .toggle-checkbox {
                    transition: right 0.2s ease-in-out, background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
                }
                .toggle-checkbox {
                    right: 1.5rem; /* Starting position */
                }
            `}</style>
            
            {/* Mobile View Container */}
            <div className="w-full max-w-sm min-h-screen relative overflow-hidden flex flex-col">
                <Header title={currentRoute} />

                {/* Main Content Area */}
                <main className="flex-1 overflow-y-auto pt-16 pb-16">
                    {renderView()}
                </main>

                <BottomNav currentRoute={currentRoute} setCurrentRoute={setCurrentRoute} />
            </div>
        </div>
    );
};

export default App;
