<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busker Finder</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure custom colors for Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-accent': '#818CF8', // indigo-400
                        'secondary-accent': '#9333ea', // purple-600
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for the toggle switch in SettingsView */
        .toggle-checkbox {
            transition: right 0.2s ease-in-out, background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            right: 1.5rem; /* Starting position */
        }
        .toggle-checkbox:checked {
            right: 0;
            border-color: #6366f1; /* indigo-500 */
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #6366f1; /* indigo-500 */
        }
    </style>
</head>
<body class="bg-gray-900 font-sans">

    <!-- Mobile View Container -->
    <div id="app" class="min-h-screen flex flex-col items-center">
        <!-- The content will be rendered inside this container -->
        <div class="w-full max-w-sm min-h-screen relative overflow-hidden flex flex-col">
            <!-- Header (fixed) -->
            <header id="app-header" class="fixed top-0 left-0 right-0 z-10 p-4 bg-gray-900 border-b border-gray-800 shadow-xl max-w-sm mx-auto">
                <!-- Content injected by JS -->
            </header>

            <!-- Main Content Area -->
            <main id="app-content" class="flex-1 overflow-y-auto pt-16 pb-16"></main>

            <!-- Bottom Navigation (fixed) -->
            <footer id="app-nav" class="fixed bottom-0 left-0 right-0 z-20 bg-gray-900 border-t border-gray-800 shadow-2xl max-w-sm mx-auto">
                <!-- Content injected by JS -->
            </footer>
        </div>
    </div>

    <script>
        // ===================================
        // GLOBAL CONSTANTS AND STATE
        // ===================================
        let currentRoute = 'Map';

        // Tailwind classes hardcoded to ensure inclusion by the CDN
        const PRIMARY_BG_CLASS = 'bg-primary-accent'; // indigo-400
        const PRIMARY_TEXT_CLASS = 'text-primary-accent';
        const PRIMARY_HOVER_BG = 'hover:bg-indigo-300';
        const SECONDARY_BG_CLASS = 'bg-secondary-accent'; // purple-600

        const NAV_ITEMS = [
            { name: 'Profile', icon: 'UserIcon' },
            { name: 'Map', icon: 'MapPinIcon' },
            { name: 'Messages', icon: 'MessageCircleIcon' },
            { name: 'Requests', icon: 'ListPlusIcon' },
            { name: 'Settings', icon: 'SettingsIcon' },
        ];

        // ===================================
        // ICON UTILITIES
        // ===================================

        const Icons = {
            UserIcon: (className = 'w-6 h-6') => `
                <svg class="${className}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            `,
            MapPinIcon: (className = 'w-6 h-6') => `
                <svg class="${className}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="3"/></svg>
            `,
            MessageCircleIcon: (className = 'w-6 h-6') => `
                <svg class="${className}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            `,
            SettingsIcon: (className = 'w-6 h-6') => `
                <svg class="${className}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 5 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 2-2v-2a2 2 0 0 1-2-2h-.09A1.65 1.65 0 0 0 3.4 5l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V15z"/></svg>
            `,
            ListPlusIcon: (className = 'w-6 h-6') => `
                <svg class="${className}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 12H3"/><path d="M16 12H3"/><path d="M21 12h-2"/><path d="M7 12V3"/><path d="M12 12V3"/><path d="M17 12V3"/><path d="M11 21H3"/><path d="M16 21H3"/><path d="M21 21h-2"/></svg>
            `,
        };

        // ===================================
        // HELPER FUNCTIONS
        // ===================================

        function updateHeader(title) {
            const header = document.getElementById('app-header');
            header.innerHTML = `
                <h1 class="text-xl font-bold text-white text-center">${title}</h1>
            `;
        }

        function setActiveRoute(routeName) {
            currentRoute = routeName;
            renderAll();
        }

        function getStatusClasses(status) {
            switch (status) {
                case 'Accepted': return `bg-green-600 text-green-100`;
                case 'Pending': return `bg-yellow-600 text-yellow-100`;
                case 'Rejected': return `bg-red-600 text-red-100`;
                default: return `bg-gray-500 text-white`;
            }
        }


        // ===================================
        // VIEW RENDERING FUNCTIONS
        // ===================================

        function getProfileViewHTML() {
            return `
                <div class="p-4 pt-16 space-y-6 text-center">
                    <div class="mx-auto w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center border-4 border-primary-accent">
                        ${Icons.UserIcon('w-16 h-16 text-primary-accent')}
                    </div>
                    <h2 class="text-3xl font-extrabold text-white">Alex 'The Rhythm' Chen</h2>
                    <p class="text-gray-400">Acoustic Guitar & Vocals | Jazz, Folk</p>

                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-white mb-3">About Me</h3>
                        <p class="text-gray-400 text-sm leading-relaxed">
                            Finding the sweet spots in the city to share some soulful tunes. I usually play near the Central Park fountain or the Subway entrance after 5 PM.
                        </p>
                    </div>

                    <button class="w-full py-3 rounded-xl font-semibold ${PRIMARY_BG_CLASS} text-gray-900 transition hover:bg-indigo-300">
                        Edit Profile
                    </button>
                </div>
            `;
        }

        function getMapViewHTML() {
            const buskers = [
                { name: "Mia", genre: "Violin", time: "Now", color: 'red' },
                { name: "Jake", genre: "Drums", time: "30m ago", color: 'yellow' },
                { name: "Duo", genre: "Acoustic", time: "1h ago", color: 'green' },
            ];

            const listItems = buskers.map(busker => `
                <div class="flex justify-between items-center p-3 bg-gray-800 rounded-xl shadow-md">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 rounded-full bg-${busker.color}-400"></div>
                        <span class="font-medium text-white">${busker.name}</span>
                        <span class="text-xs font-light text-gray-500">‚Ä¢ ${busker.genre}</span>
                    </div>
                    <button class="text-xs font-semibold text-gray-900 px-3 py-1 rounded-full ${PRIMARY_BG_CLASS} hover:bg-indigo-300">
                        View
                    </button>
                </div>
            `).join('');

            return `
                <div class="relative h-full min-h-[calc(100vh-128px)] flex flex-col justify-center">
                    <!-- Simulated Map Area -->
                    <div class="flex flex-col items-center justify-center h-full bg-gray-800 text-white p-4 flex-1">
                        <div class="text-2xl font-bold mb-4">üìç Central City Plaza</div>
                        <p class="text-gray-400 mb-6">Live Map (Simulated)</p>

                        <!-- Simulated Busker Pins -->
                        <div class="absolute top-1/4 left-1/4 p-2 bg-red-600 rounded-full shadow-lg border-2 border-white animate-pulse cursor-pointer">
                            ${Icons.MapPinIcon('w-5 h-5 text-white')}
                        </div>
                        <div class="absolute top-3/5 right-1/3 p-2 bg-yellow-600 rounded-full shadow-lg border-2 border-white animate-pulse cursor-pointer">
                            ${Icons.MapPinIcon('w-5 h-5 text-white')}
                        </div>
                        <div class="absolute bottom-1/4 left-3/4 p-2 bg-green-600 rounded-full shadow-lg border-2 border-white opacity-70 cursor-pointer">
                            ${Icons.MapPinIcon('w-5 h-5 text-white')}
                        </div>
                    </div>

                    <!-- Live Busker List Overlay -->
                    <div class="absolute bottom-0 w-full p-4 bg-gray-900/90 backdrop-blur-sm rounded-t-2xl border-t border-gray-700">
                        <h3 class="text-lg font-semibold text-white mb-3">Live Buskers Nearby (3)</h3>
                        <div class="space-y-2">
                            ${listItems}
                        </div>
                    </div>
                </div>
            `;
        }

        function getMessagesViewHTML() {
            const chats = [
                { id: 1, name: "Street Jam Organizer", lastMessage: "See you at the spot on Friday!", time: "10:30 AM", unread: 2 },
                { id: 2, name: "Fan of the Day", lastMessage: "Your set yesterday was amazing!", time: "Yesterday", unread: 0 },
                { id: 3, name: "Guitar Repair Shop", lastMessage: "Your custom strings are ready.", time: "Mon", unread: 0 },
            ];

            const listItems = chats.map(chat => `
                <div class="flex items-center space-x-4 p-3 bg-gray-800 rounded-xl transition hover:bg-gray-700 cursor-pointer">
                    <div class="relative w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center">
                        ${Icons.MessageCircleIcon('w-6 h-6 text-gray-400')}
                        ${chat.unread > 0 ? `
                            <span class="absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center text-xs font-bold text-white ${SECONDARY_BG_CLASS} rounded-full">
                                ${chat.unread}
                            </span>
                        ` : ''}
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-semibold text-white truncate">${chat.name}</p>
                        <p class="text-sm text-gray-400 truncate">${chat.lastMessage}</p>
                    </div>
                    <span class="text-xs text-gray-500 flex-shrink-0">${chat.time}</span>
                </div>
            `).join('');

            return `
                <div class="p-4 pt-16 space-y-3">
                    <h2 class="text-2xl font-bold text-white mb-4">Direct Messages</h2>
                    ${listItems}
                    <div class="text-center pt-4">
                        <button class="${PRIMARY_TEXT_CLASS} font-medium">Start New Chat</button>
                    </div>
                </div>
            `;
        }

        function getSettingsViewHTML() {
            return `
                <div class="p-4 pt-16 space-y-6">
                    <h2 class="text-2xl font-bold text-white mb-4">App Settings</h2>

                    <div class="bg-gray-800 p-4 rounded-xl space-y-3 shadow-lg">
                        <div class="flex justify-between items-center pb-2 border-b border-gray-700">
                            <span class="text-white">Push Notifications</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle-push" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-gray-600 border-4 appearance-none cursor-pointer checked:bg-indigo-500 checked:right-0" checked/>
                                <label for="toggle-push" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <div class="flex justify-between items-center pb-2 border-b border-gray-700">
                            <span class="text-white">Location Sharing (Live)</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle-location" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-gray-600 border-4 appearance-none cursor-pointer checked:bg-indigo-500 checked:right-0" />
                                <label for="toggle-location" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-700 cursor-pointer"></label>
                            </div>
                        </div>

                        <p class="text-sm text-gray-500 pt-2">
                            *The dark theme is mandatory and cannot be changed.
                        </p>
                    </div>

                    <button class="w-full py-3 rounded-xl font-semibold bg-red-600 text-white transition hover:bg-red-700">
                        Log Out
                    </button>
                </div>
            `;
        }

        function getRequestsViewHTML() {
            const requests = [
                { id: 1, type: "Song Request", user: "Sarah K.", song: "Wonderwall - Oasis", status: "Pending"},
                { id: 2, type: "Gig Invite", user: "Local Cafe Owner", song: "Friday Night Slot", status: "Accepted"},
                { id: 3, type: "Collaboration", user: "Drummer Mike", song: "Improvisational Session", status: "Rejected"},
            ];

            const listItems = requests.map(req => `
                <div class="p-4 bg-gray-800 rounded-xl shadow-lg">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-sm font-semibold rounded-full px-3 py-1 ${getStatusClasses(req.status)}">
                            ${req.type}
                        </span>
                        <span class="text-xs text-gray-500">${req.user}</span>
                    </div>
                    <h3 class="text-lg font-medium text-white">${req.song}</h3>
                    <p class="text-sm text-gray-400">
                        ${req.type === 'Song Request' ? 'Requested song from the crowd.' : 'Invitation for a paid performance.'}
                    </p>

                    <div class="mt-3 flex space-x-2">
                        ${req.status === 'Pending' ? `
                            <button class="flex-1 py-2 rounded-lg text-sm font-semibold ${PRIMARY_BG_CLASS} text-gray-900 hover:bg-indigo-300" onclick="handleRequestAction(${req.id}, 'accept')">Accept</button>
                            <button class="flex-1 py-2 rounded-lg text-sm font-semibold border border-red-500 text-red-400 hover:bg-red-500 hover:text-white transition" onclick="handleRequestAction(${req.id}, 'decline')">Decline</button>
                        ` : `
                            <span class="text-sm font-medium text-gray-500">Action Complete</span>
                        `}
                    </div>
                </div>
            `).join('');

            return `
                <div class="p-4 pt-16 space-y-4">
                    <h2 class="text-2xl font-bold text-white mb-4">My Requests & Invites</h2>
                    <div class="space-y-3">
                        ${listItems}
                    </div>
                </div>
            `;
        }

        function renderBottomNav() {
            const nav = document.getElementById('app-nav');
            const navHTML = NAV_ITEMS.map(item => {
                const isActive = currentRoute === item.name;
                const activeColor = isActive ? PRIMARY_TEXT_CLASS : 'text-gray-500';
                const Icon = Icons[item.icon];

                return `
                    <button
                        onclick="setActiveRoute('${item.name}')"
                        class="flex flex-col items-center justify-center p-2 transition duration-150 ease-in-out"
                        aria-label="Navigate to ${item.name}"
                    >
                        ${Icon('w-6 h-6 ' + activeColor)}
                        <span class="text-xs font-medium mt-0.5 ${activeColor}">
                            ${item.name}
                        </span>
                    </button>
                `;
            }).join('');

            nav.innerHTML = `
                <nav class="flex justify-around items-center h-16 max-w-sm mx-auto">
                    ${navHTML}
                </nav>
            `;
        }

        function renderAll() {
            const content = document.getElementById('app-content');
            let html = '';

            // Render view content based on current route
            switch (currentRoute) {
                case 'Profile':
                    html = getProfileViewHTML();
                    break;
                case 'Map':
                    html = getMapViewHTML();
                    break;
                case 'Messages':
                    html = getMessagesViewHTML();
                    break;
                case 'Settings':
                    html = getSettingsViewHTML();
                    break;
                case 'Requests':
                    html = getRequestsViewHTML();
                    break;
                default:
                    html = getMapViewHTML();
            }

            content.innerHTML = html;
            updateHeader(currentRoute);
            renderBottomNav();
        }

        // Dummy handler for button actions
        function handleRequestAction(id, action) {
             console.log(`Request ID: ${id}, Action: ${action} attempted.`);
             // In a real app, this would update the Firestore/API.
             // For this demo, we can just alert the user (using console.log instead of alert())
        }

        // ===================================
        // INITIALIZATION
        // ===================================
        window.onload = renderAll;
    </script>
</body>
</html>
